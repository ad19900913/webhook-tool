# 配置管理快速开始指南

本文档提供Webhook工具配置管理系统的快速开始指南，帮助您快速上手配置管理功能。

## 快速开始

### 1. 安装依赖

首先安装配置管理所需的依赖包：

```bash
npm install
```

### 2. 创建配置文件

复制示例配置文件并根据需要修改：

```bash
# 复制默认配置
cp config/default.json config/local.json

# 复制环境配置示例
cp config/development.json config/local.json
```

### 3. 设置环境变量

创建 `.env` 文件（基于 `.env.example`）：

```bash
# 服务器配置
NODE_ENV=development
SERVER_PORT=3000
SERVER_HOST=localhost

# Webhook配置
WEBHOOK_MAX_PAYLOAD_SIZE=10mb
WEBHOOK_RATE_LIMIT_MAX=100

# 日志配置
LOGGING_LEVEL=debug
```

### 4. 启动应用

```bash
# 开发模式
npm run dev

# 生产模式
npm start
```

## 配置管理界面

### 访问配置管理界面

启动应用后，访问配置管理界面：

```
http://localhost:3000/config-manager.html
```

### 主要功能

- **配置概览**：查看和编辑主要配置项
- **分类管理**：按功能模块组织配置
- **实时验证**：配置修改后立即验证
- **配置重载**：支持热重载配置
- **配置导出**：支持JSON格式导出

## 常用配置项

### 服务器配置

```json
{
  "server": {
    "port": 3000,
    "host": "0.0.0.0",
    "timeout": 30000,
    "maxBodySize": "100mb"
  }
}
```

### Webhook配置

```json
{
  "webhook": {
    "maxPayloadSize": "10mb",
    "rateLimit": {
      "windowMs": 900000,
      "max": 100
    },
    "security": {
      "enableIpWhitelist": false,
      "enableSignature": false
    }
  }
}
```

### 日志配置

```json
{
  "logging": {
    "level": "info",
    "maxSize": "100mb",
    "maxFiles": 5,
    "retentionDays": 30
  }
}
```

## API使用示例

### 获取配置信息

```bash
curl http://localhost:3000/api/config
```

### 获取配置摘要

```bash
curl http://localhost:3000/api/config/summary
```

### 更新配置值

```bash
curl -X PUT http://localhost:3000/api/config/server.port \
  -H "Content-Type: application/json" \
  -d '{"value": 8080}'
```

### 重新加载配置

```bash
curl -X POST http://localhost:3000/api/config/reload
```

## 环境变量配置

### 常用环境变量

| 变量名 | 说明 | 示例值 |
|--------|------|--------|
| `NODE_ENV` | 运行环境 | `development`, `production`, `test` |
| `SERVER_PORT` | 服务器端口 | `3000`, `8080` |
| `SERVER_HOST` | 服务器地址 | `localhost`, `0.0.0.0` |
| `LOGGING_LEVEL` | 日志级别 | `debug`, `info`, `warn`, `error` |
| `WEBHOOK_MAX_PAYLOAD_SIZE` | 最大负载 | `10mb`, `100mb` |

### 环境变量优先级

环境变量配置的优先级最高，会覆盖配置文件中的设置：

```bash
# 设置环境变量
export SERVER_PORT=8080
export LOGGING_LEVEL=debug

# 启动应用
npm start
```

## 配置文件优先级

配置加载优先级（从高到低）：

1. **环境变量**：`SERVER_PORT`, `LOGGING_LEVEL` 等
2. **本地配置**：`config/local.json`
3. **环境配置**：`config/development.json`, `config/production.json`
4. **默认配置**：`config/default.json`

## 配置验证

### 自动验证

配置系统会自动验证配置的有效性：

- 数据类型检查
- 必填字段验证
- 数值范围验证
- 枚举值验证

### 手动验证

通过API验证配置：

```bash
curl -X POST http://localhost:3000/api/config/validate \
  -H "Content-Type: application/json" \
  -d '{"config": {...}}'
```

## 故障排除

### 常见问题

#### 1. 配置加载失败

**错误信息**：`配置加载失败: ...`
**解决方案**：
- 检查配置文件语法
- 确认文件路径正确
- 检查文件权限

#### 2. 配置验证失败

**错误信息**：`配置验证失败: ...`
**解决方案**：
- 检查配置值类型
- 确认必填字段完整
- 验证数值范围

#### 3. 环境变量不生效

**问题**：设置环境变量后配置未更新
**解决方案**：
- 确认变量名正确
- 重启应用
- 检查变量映射

### 调试技巧

1. **查看配置状态**：访问 `/api/config` 查看当前配置
2. **启用调试日志**：设置 `DEBUG=webhook:*` 环境变量
3. **检查环境信息**：访问 `/api/config/environment` 查看环境变量

## 最佳实践

### 1. 配置文件管理

- 使用 `local.json` 存储本地开发配置
- 不要将 `local.json` 提交到版本控制
- 定期备份生产环境配置

### 2. 环境变量使用

- 敏感信息使用环境变量
- 为环境变量设置有意义的默认值
- 使用大写字母和下划线分隔

### 3. 配置安全

- 限制配置管理API访问权限
- 对敏感配置进行加密
- 记录配置变更日志

## 下一步

完成基础配置后，您可以：

1. **自定义配置**：根据需求调整配置项
2. **环境配置**：为不同环境创建配置文件
3. **监控配置**：配置监控和告警参数
4. **性能调优**：根据负载调整性能参数

## 获取帮助

如果在使用过程中遇到问题：

1. 查看本文档的故障排除部分
2. 检查应用日志获取详细错误信息
3. 访问配置管理界面查看配置状态
4. 提交Issue到项目仓库

---

**提示**：建议先在开发环境中测试配置，确认无误后再应用到生产环境。
